{
  "description": "Database unit tests",
  "exitCode": 0,
  "timestamp": "2025-08-17T17:45:31.707Z",
  "stdout": "BEGIN\r\nCREATE EXTENSION\r\nSET\r\nSET\r\nğŸ§ª P10: Starting database unit tests...\r\nğŸ“‹ Testing CHECK constraints...\r\nDO\r\nDO\r\nDO\r\nğŸ“‹ Testing UNIQUE constraints...\r\nDO\r\nğŸ“‹ Testing Foreign Key constraints...\r\nDO\r\nğŸ“‹ Testing RLS policies...\r\nDO\r\nğŸ“‹ Testing XP events immutability...\r\nDO\r\nDO\r\nDO\r\nğŸ“‹ Testing RPC idempotency...\r\nDO\r\nğŸ“‹ Testing edge cases...\r\nDO\r\nDO\r\nğŸ“‹ Testing achievement unlocks...\r\nDO\r\nCOMMIT\r\nâœ… P10: Database unit tests completed successfully\r\n   - Constraint validation passed\r\n   - RLS policies verified\r\n   - XP events immutability confirmed\r\n   - RPC idempotency validated\r\n   - Edge cases handled correctly\r\n   - Achievement system tested\r\n",
  "stderr": "psql:C:/GitHub/ai_foundations_lms/scripts/p10/db_unit.sql:3: NOTICE:  extension \"pgcrypto\" already exists, skipping\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/db_unit.sql:40: NOTICE:  âœ… Negative delta clamped. xp_after=0\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/db_unit.sql:51: NOTICE:  âœ… CHECK constraint correctly prevented level < 1\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/db_unit.sql:65: NOTICE:  âš ï¸  No constraint violation for negative streak - constraint may be missing\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/db_unit.sql:96: NOTICE:  âœ… UNIQUE constraint correctly enforced via idempotency key\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/db_unit.sql:116: NOTICE:  âœ… FK constraint correctly prevented reference to non-existent user: profile_not_found\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/db_unit.sql:155: NOTICE:  âœ… RLS enabled on xp_events table\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/db_unit.sql:155: NOTICE:  âœ… RLS enabled on profiles table\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/db_unit.sql:155: NOTICE:  âœ… RLS enabled on user_achievements table\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/db_unit.sql:175: NOTICE:  Created immutable test event: 3e97e36f-6131-492b-b780-697078f472ed\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/db_unit.sql:190: NOTICE:  âœ… XP events correctly protected from UPDATE\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/db_unit.sql:205: NOTICE:  âœ… XP events correctly protected from DELETE\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/db_unit.sql:257: NOTICE:  âœ… credit_xp idempotency working correctly\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/db_unit.sql:257: NOTICE:     Initial XP: 35, Final XP: 85, Event ID: 853c1c4c-fd15-46cf-82ed-a9d8ad763e2e\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/db_unit.sql:282: NOTICE:  âœ… compute_level_info works for 0 XP: (1,0,100)\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/db_unit.sql:282: NOTICE:  âœ… compute_level_info works for 100 XP: (2,100,150)\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/db_unit.sql:282: NOTICE:  âœ… compute_level_info works for high XP: (20,10000,)\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/db_unit.sql:310: NOTICE:  âœ… Negative XP delta correctly clamped. XP: 85 -> 0\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/db_unit.sql:367: NOTICE:  âš ï¸  Achievement test failed (may be normal): Conditions achievement non remplies. Progress: 0/1 pour lesson_count\r\n"
}