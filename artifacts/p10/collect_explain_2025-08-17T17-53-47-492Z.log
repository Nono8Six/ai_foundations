{
  "description": "EXPLAIN ANALYZE collection",
  "exitCode": 0,
  "timestamp": "2025-08-17T17:53:47.492Z",
  "stdout": "üìã P10: Collecting EXPLAIN ANALYZE for key RPC functions...\r\nüîç Analyzing credit_xp function...\r\n=====================================;\r\n                                                                              QUERY PLAN                                                                               \r\n-----------------------------------------------------------------------------------------------------------------------------------------------------------------------\r\n Result  (cost=0.00..0.26 rows=1 width=32) (actual time=1.000..1.000 rows=1 loops=1)\r\n   Output: credit_xp('00000000-0000-0000-0000-000000000001'::uuid, 'lesson:completion'::text, 50, 'explain-credit-xp-test'::text, NULL::uuid, NULL::text, '{}'::jsonb)\r\n   Buffers: shared hit=345\r\n Query Identifier: -2722577134236380289\r\n Planning Time: 0.024 ms\r\n Execution Time: 1.015 ms\r\n(6 rows)\r\n\r\n;\r\nüîç Analyzing get_active_xp_sources function...\r\n==============================================;\r\n                                         QUERY PLAN                                          \r\n---------------------------------------------------------------------------------------------\r\n ProjectSet  (cost=0.00..5.27 rows=1000 width=32) (actual time=0.187..0.216 rows=24 loops=1)\r\n   Output: get_active_xp_sources(now())\r\n   Buffers: shared hit=2\r\n   ->  Result  (cost=0.00..0.01 rows=1 width=0) (actual time=0.001..0.002 rows=1 loops=1)\r\n Query Identifier: -1125711535403011146\r\n Planning Time: 0.026 ms\r\n Execution Time: 0.243 ms\r\n(7 rows)\r\n\r\n;\r\nüîç Analyzing compute_level_info function...\r\n===========================================;\r\n                                         QUERY PLAN                                         \r\n--------------------------------------------------------------------------------------------\r\n ProjectSet  (cost=0.00..5.27 rows=1000 width=32) (actual time=0.314..0.320 rows=1 loops=1)\r\n   Output: compute_level_info(150)\r\n   Buffers: shared hit=4\r\n   ->  Result  (cost=0.00..0.01 rows=1 width=0) (actual time=0.001..0.001 rows=1 loops=1)\r\n Query Identifier: -6337873644889589703\r\n Planning Time: 0.022 ms\r\n Execution Time: 0.343 ms\r\n(7 rows)\r\n\r\n;\r\nüîç Testing unlock_achievement function (may skip if security constraints active)...\r\n===============================================================================;\r\nDO\r\n;\r\nüìä Index Usage Analysis;\r\n========================;\r\n schemaname |     tablename     |                            indexname                            | scans | tuples_read | tuples_fetched \r\n------------+-------------------+-----------------------------------------------------------------+-------+-------------+----------------\r\n public     | level_definitions | ix_level_definitions_level_xp_required                          |  5861 |        5862 |           5861\r\n public     | level_definitions | level_definitions_pkey                                          |   164 |         684 |            684\r\n public     | level_definitions | uq_xp_required                                                  |     4 |           5 |              4\r\n public     | level_definitions | idx_level_definitions_xp_required                               |     0 |           0 |              0\r\n public     | level_definitions | uq_level                                                        |     0 |           0 |              0\r\n public     | profiles          | idx_profiles_user_id                                            |  4132 |      309070 |           3095\r\n public     | profiles          | profiles_pkey                                                   |   175 |         578 |            142\r\n public     | profiles          | idx_profiles_created_at                                         |    64 |          64 |             64\r\n public     | profiles          | profiles_email_key                                              |     0 |           0 |              0\r\n public     | profiles          | idx_profiles_admin                                              |     0 |           0 |              0\r\n public     | profiles          | idx_profiles_xp_level                                           |     0 |           0 |              0\r\n public     | profiles          | idx_profiles_email                                              |     0 |           0 |              0\r\n public     | user_achievements | idx_user_achievements_user_id                                   |     6 |          19 |             17\r\n public     | user_achievements | user_achievements_pkey                                          |     2 |           0 |              0\r\n public     | user_achievements | user_achievements_user_id_achievement_type_achievement_name_key |     0 |           0 |              0\r\n public     | user_achievements | ux_ua_user_ach_ver_scope                                        |     0 |           0 |              0\r\n public     | user_achievements | idx_user_achievements_user_type                                 |     0 |           0 |              0\r\n public     | user_achievements | idx_user_achievements_type                                      |     0 |           0 |              0\r\n public     | xp_events         | uk_xp_events_idempotency                                        |  3140 |        1825 |            434\r\n public     | xp_events         | xp_events_pkey                                                  |    32 |          42 |             32\r\n public     | xp_events         | idx_xp_events_user_aggregates                                   |     2 |           2 |              0\r\n public     | xp_events         | idx_xp_events_user_created                                      |     1 |         174 |            162\r\n public     | xp_events         | idx_xp_events_source_stats                                      |     0 |           0 |              0\r\n public     | xp_events         | idx_xp_events_source_type                                       |     0 |           0 |              0\r\n public     | xp_events         | idx_xp_events_created_at                                        |     0 |           0 |              0\r\n public     | xp_sources        | uq_xp_sources_type_action_version                               |   136 |         132 |            128\r\n public     | xp_sources        | ex_xp_sources_active_overlap                                    |     6 |          24 |              4\r\n public     | xp_sources        | xp_sources_pkey                                                 |     5 |          36 |             36\r\n public     | xp_sources        | idx_xp_sources_active_type                                      |     3 |          30 |             20\r\n public     | xp_sources        | idx_xp_sources_active                                           |     0 |           0 |              0\r\n(30 rows)\r\n\r\n;\r\nüìä Table Statistics;\r\n===================;\r\n schemaname |     tablename     | seq_scan | seq_tup_read | idx_scan | idx_tup_fetch | inserts | updates | deletes | live_tuples | dead_tuples \r\n------------+-------------------+----------+--------------+----------+---------------+---------+---------+---------+-------------+-------------\r\n public     | level_definitions |     4737 |        66313 |     6029 |          6549 |      15 |      10 |       0 |          14 |          11\r\n public     | profiles          |    27629 |        36507 |     4371 |          4330 |      20 |    3003 |       0 |           5 |         163\r\n public     | user_achievements |     2400 |         7064 |        8 |            17 |      13 |       4 |       3 |           3 |          14\r\n public     | xp_events         |     3567 |        20244 |     3175 |           630 |    2736 |      15 |    2451 |         170 |         163\r\n public     | xp_sources        |     2160 |        10496 |      150 |           188 |      47 |     210 |      22 |          24 |           6\r\n(5 rows)\r\n\r\n;\r\nüîß Query Plan Cache Stats;\r\n==========================;\r\n funcname | calls | total_time | mean_time | self_time \r\n----------+-------+------------+-----------+-----------\r\n(0 rows)\r\n\r\n;\r\nüíæ Buffer Cache Analysis;\r\n========================;\r\n      relname      |  size  | heap_read | heap_hit | cache_hit_ratio \r\n-------------------+--------+-----------+----------+-----------------\r\n level_definitions | 96 kB  |         0 |    10812 |          100.00\r\n profiles          | 320 kB |         1 |   435182 |          100.00\r\n user_achievements | 112 kB |         0 |     2412 |          100.00\r\n xp_events         | 312 kB |         0 |    17598 |          100.00\r\n xp_sources        | 128 kB |         0 |     5308 |          100.00\r\n(5 rows)\r\n\r\n;\r\nüîí Lock Analysis;\r\n================;\r\n pid | locktype | mode | granted | table_name \r\n-----+----------+------+---------+------------\r\n(0 rows)\r\n\r\n;\r\n‚ö° Performance Recommendations;\r\n==============================;\r\nDO\r\n;\r\n‚úÖ P10: EXPLAIN ANALYZE collection completed;\r\n   - Execution plans captured for all key RPC functions;\r\n   - Index usage patterns analyzed;\r\n   - Buffer cache effectiveness measured;\r\n   - Performance recommendations generated;\r\n",
  "stderr": "psql:C:/GitHub/ai_foundations_lms/scripts/p10/collect_explain.sql:61: NOTICE:  unlock_achievement skipped due to security constraints or schema issues: profiles writes must go through credit_xp (ctx=unlock_achievement)\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/collect_explain.sql:61: NOTICE:  This is expected in production environment with P6/P8 guards active.\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/collect_explain.sql:227: NOTICE:  Performance Recommendations:\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/collect_explain.sql:227: NOTICE:  üìã Unused index detected: profiles_email_key on profiles (consider dropping)\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/collect_explain.sql:227: NOTICE:  üìã Unused index detected: idx_profiles_email on profiles (consider dropping)\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/collect_explain.sql:227: NOTICE:  üìã Unused index detected: idx_profiles_xp_level on profiles (consider dropping)\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/collect_explain.sql:227: NOTICE:  üìã Unused index detected: idx_profiles_admin on profiles (consider dropping)\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/collect_explain.sql:227: NOTICE:  üìã Unused index detected: idx_xp_events_source_type on xp_events (consider dropping)\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/collect_explain.sql:227: NOTICE:  üìã Unused index detected: idx_xp_events_source_stats on xp_events (consider dropping)\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/collect_explain.sql:227: NOTICE:  üìã Unused index detected: idx_xp_events_created_at on xp_events (consider dropping)\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/collect_explain.sql:227: NOTICE:  üìã Unused index detected: uq_level on level_definitions (consider dropping)\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/collect_explain.sql:227: NOTICE:  üìã Unused index detected: idx_level_definitions_xp_required on level_definitions (consider dropping)\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/collect_explain.sql:227: NOTICE:  üìã Unused index detected: user_achievements_user_id_achievement_type_achievement_name_key on user_achievements (consider dropping)\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/collect_explain.sql:227: NOTICE:  üìã Unused index detected: idx_user_achievements_type on user_achievements (consider dropping)\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/collect_explain.sql:227: NOTICE:  üìã Unused index detected: idx_user_achievements_user_type on user_achievements (consider dropping)\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/collect_explain.sql:227: NOTICE:  üìã Unused index detected: ux_ua_user_ach_ver_scope on user_achievements (consider dropping)\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/collect_explain.sql:227: NOTICE:  üìã Unused index detected: idx_xp_sources_active on xp_sources (consider dropping)\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/collect_explain.sql:227: NOTICE:  üîç High sequential scan ratio for profiles: 86.34%% (consider adding indexes)\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/collect_explain.sql:227: NOTICE:  üîç High sequential scan ratio for xp_sources: 93.51%% (consider adding indexes)\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/collect_explain.sql:227: NOTICE:  üîç High sequential scan ratio for user_achievements: 99.67%% (consider adding indexes)\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/collect_explain.sql:227: NOTICE:  üîç High sequential scan ratio for xp_events: 52.91%% (consider adding indexes)\r\npsql:C:/GitHub/ai_foundations_lms/scripts/p10/collect_explain.sql:227: NOTICE:  üîç High sequential scan ratio for level_definitions: 44.00%% (consider adding indexes)\r\n"
}